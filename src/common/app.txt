import { useState, useEffect } from "react";
import "./styles.css";

export default function App() {
  const [data, setData] = useState([]); // Single state to hold all user data
  const [loading, setLoading] = useState(false); // For loading indicator
  const [pageNumber, setPageNumber] = useState(1); // To track the current page

  // Function to fetch user data
  const fetchData = async (page) => {
    setLoading(true); // Set loading to true before fetching
    try {
      const response = await fetch(`https://randomuser.me/api?page=${page}`);
      if (!response.ok) {
        throw new Error("Failed to fetch data");
      }
      const result = await response.json();
      const newUser = result.results[0]; // Get the first user from the fetched results
      setData((prevData) => [...prevData, newUser]); // Append the new user to the existing data
    } catch (err) {
      console.error("Error fetching data:", err.message);
    } finally {
      setLoading(false); // Set loading to false after fetching
    }
  };

  // Initial fetch for the first user
  useEffect(() => {
    fetchData(1); // Fetch the first user on page load
  }, []); // Empty dependency array ensures it runs only once

  // Handle button click to fetch additional users
  const handleButtonClick = () => {
    const nextPage = pageNumber + 1;
    setPageNumber(nextPage); // Increment the page number
    fetchData(nextPage); // Fetch a new user and append to data
  };

  return (
    <div>
      <h1>Users</h1>
      <div>
        {data.map((user, index) => (
          <div key={index}>
            <p>
              {user.name.first} {user.name.last}
            </p>
            <img
              src={user.picture.thumbnail}
              alt={`${user.name.first}'s thumbnail`}
            />
          </div>
        ))}
      </div>
      <br />
      <button onClick={handleButtonClick} disabled={loading}>
        {loading ? "Loading..." : "Add User"}
      </button>
    </div>
  );
}
